
<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nota Viewer</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #f0f0f0;
        }

        iframe {
            border: none;
            width: 100%;
            height: 100%;
        }

        .fab {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 50%;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            font-size: 30px;
            text-align: center;
            line-height: 60px;
            cursor: pointer;
            z-index: 9999;

            opacity: 0;
            transform: translateY(100px);
            transition: transform 0.5s ease, opacity 0.5s ease, background-color 0.3s ease;
        }

        .fab.show {
            opacity: 1;
            transform: translateY(0);
        }

        .fab:hover {
            background-color: #45a049;
            transform: translateY(0) scale(1.1);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .spin svg {
            animation: spin 1s linear infinite;
        }

        .fab svg {
            vertical-align: middle;
        }

        .loader-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #4CAF50, #2196F3);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 99999;
        }

        .loader-logo {
            width: 100px;
            height: 100px;
            animation: spin 1s linear infinite;
        }
    </style>
</head>

<body>

    <div id="loader" class="loader-overlay">
        <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiibViPYKYXdHuvx-DmyCm_IKRkbjX1UBdYgR7PHsWGhdMESnh9_YorRYXec5QPRhSzGDR_xbqbOJI48MEagTnfRmNlM7cDrQeo8l4yd8D3At0f-7TKa3FB-akVsj3Zmz8vVzaEVsIm9LYv8zd2GK85LS64Hz9wI9LFJRPas4A1N404vH8H4up6olL8l-z_/s1280/1000340306.jpg" alt="Loading..." class="loader-logo">
    </div>

    <iframe id="notaFrame"></iframe>

    <button id="downloadBtn" class="fab" title="Download PDF" disabled>
        <svg width="30" height="30" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg">
            <path d="M5 20h14v-2H5v2zM12 2v12l4-4 1.41 1.41L12 17.83l-5.41-5.42L8 10l4 4V2h0z"/>
        </svg>
    </button>

    <script>
        const pathSegments = window.location.pathname.split('/');
        const notaId = pathSegments[pathSegments.length - 1] || pathSegments[pathSegments.length - 2];

        const webAppUrl = 'https://script.google.com/macros/s/AKfycbxb5-sB0milMtSnlNU_wzmylHj6V1CHe3bJfBhhRneC_ro54fbZ6oA3lhN_Nh8YwFT2/exec?key=ndtech123';

        function loadNota() {
            fetch(webAppUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.data[notaId]) {
                        const fileUrl = data.data[notaId];

                        const notaFrame = document.getElementById('notaFrame');
                        const downloadBtn = document.getElementById('downloadBtn');

                        downloadBtn.disabled = true;
                        downloadBtn.classList.add('show');
                        downloadBtn.classList.add('spin');

                        notaFrame.src = fileUrl;

                        notaFrame.onload = () => {
                            downloadBtn.classList.remove('spin');
                            downloadBtn.disabled = false;

                            const loader = document.getElementById('loader');
                            loader.style.display = 'none';
                        };

                        downloadBtn.onclick = () => {
                            const a = document.createElement('a');
                            a.href = fileUrl;
                            a.download = notaId + '.pdf';
                            document.body.appendChild(a);
                            a.click();
                            document.body.removeChild(a);
                        };
                    } else {
                        alert('Nota tidak ditemukan.');
                    }
                })
                .catch(error => {
                    console.error('Error loading JSON:', error);
                    alert('Gagal memuat data.');
                });
        }

        loadNota();
    </script>

</body>

</html>
